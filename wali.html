<!DOCTYPE html>
<html>
<head>
  <title>Wali Kelas</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="header">
  <h2 id="judul">Wali Kelas</h2>
  <p>بِسْمِ اللّٰهِ الرَّحْمٰنِ الرَّحِيْمِ</p>
</div>

<div class="container">

  <div class="card">
    <h3>Tambah Siswa</h3>
    <input type="text" id="namaBaru" placeholder="Nama siswa">
    <input type="number" id="nilaiBaru" placeholder="Nilai">
    <button type="button" class="btn-tambah" onclick="tambahSiswa()">
  Tambah Siswa
</button>
  </div>

  <div class="card">
    <h3>Data Siswa</h3>
    <table>
      <thead>
        <tr>
          <th>Nama</th>
          <th>Nilai</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="tabelSiswa"></tbody>
    </table>
  </div>

</div>
<div class="card">
  <h3>Grafik Perkembangan Nilai Siswa</h3>
  <canvas id="grafiknilai"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="js/data-siswa.js"></script>

<script>
  var kelasLogin = localStorage.getItem("kelas");
  document.getElementById("judul").innerText =
    "Wali Kelas " + kelasLogin;

  var tabel = document.getElementById("tabelSiswa");

  function tampilkan() {
    tabel.innerHTML = "";
    dataSiswa.forEach(function(siswa, index) {
      if (siswa.kelas === kelasLogin) {
        tabel.innerHTML += `
          <tr>
            <td>${siswa.nama}</td>
            <td>${siswa.nilai}</td>
            <td>
              <button onclick="hapusSiswa(${index})">Hapus</button>
            </td>
          </tr>
        `;
      }
    });
  }

  function tambahSiswa() {
  var nama = document.getElementById("namaBaru").value;
  var nilai = document.getElementById("nilaiBaru").value;

  if (nama === "" || nilai === "") {
    alert("Nama dan nilai wajib diisi");
    return;
  }

  dataSiswa.push({
    nama: nama,
    kelas: kelasLogin,
    nilai: parseInt(nilai)
  });

  localStorage.setItem("dataSiswa", JSON.stringify(dataSiswa));

  document.getElementById("namaBaru").value = "";
  document.getElementById("nilaiBaru").value = "";

  tampilkan();
  location.reload(); // memastikan grafik ikut update
}

  function hapusSiswa(index) {
    if (confirm("Hapus siswa ini?")) {
      dataSiswa.splice(index, 1);
      localStorage.setItem("dataSiswa", JSON.stringify(dataSiswa));
      tampilkan();
    }
  }

  tampilkan();
  <script>
  tampilkan();

  var nilai = [];
  var nama = [];

  dataSiswa.forEach(function(s) {
    if (s.kelas === kelasLogin) {
      nama.push(s.nama);
      nilai.push(Number(s.nilai));
    }
  });

  var ctx = document.getElementById('grafikNilai');

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: nama,
      datasets: [{
        label: 'Nilai Siswa',
        data: nilai,
        backgroundColor: '#0f9d58'
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          max: 100
        }
      }
    }
  });
</script>

</script>

</body>
</html>
